import networkx as nx
import matplotlib.pyplot as plt
import random

TAMANHO = 20  # Grid 20x20

CUSTO_GRAMA = 1
CUSTO_FLORESTA = 5
CUSTO_AGUA = 20  # Muito caro, o A* vai evitar ao máximo

print(f"Gerando mundo RPG {TAMANHO}x{TAMANHO}...")

G = nx.grid_2d_graph(TAMANHO, TAMANHO)
inicio = (0, 0)
objetivo = (TAMANHO - 1, TAMANHO - 1)

tipo_terreno = {} 

for node in G.nodes():
    
    if node == inicio or node == objetivo:
        tipo_terreno[node] = 'grama'
        continue
    
    if sorteio < 0.60:
        tipo_terreno[node] = 'grama'
    elif sorteio < 0.80:
        tipo_terreno[node] = 'floresta'
    elif sorteio < 0.90:
        tipo_terreno[node] = 'agua'
    else:
        tipo_terreno[node] = 'muro'

nos_para_remover = []

for node in G.nodes():
    terreno = tipo_terreno[node]
    
    if terreno == 'muro':
        nos_para_remover.append(node)
    else:
        peso = CUSTO_GRAMA
        if terreno == 'floresta': peso = CUSTO_FLORESTA
        elif terreno == 'agua': peso = CUSTO_AGUA
        
        
        for vizinho in G.neighbors(node):
            G[node][vizinho]['weight'] = peso

G.remove_nodes_from(nos_para_remover)
def heuristica(a, b):
    return abs(a[0] - b[0]) + abs(a[1] - b[1])

print("Calculando a melhor rota considerando os terrenos...")
caminho = []
custo_total = 0

try:
    caminho = nx.astar_path(G, inicio, objetivo, heuristic=heuristica, weight='weight')
    custo_total = sum(G[u][v]['weight'] for u, v in zip(caminho[:-1], caminho[1:]))
    print(f"SUCESSO! Passos: {len(caminho)} | Custo (Esforço): {custo_total}")
except nx.NetworkXNoPath:
    print("O mapa gerado bloqueou o caminho totalmente. Tente novamente.")
